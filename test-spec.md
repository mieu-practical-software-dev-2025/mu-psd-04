# テスト仕様書: アキネーター風アプリ

## 1. テスト対象
- **バックエンド**: `app.py` (Flaskサーバー)
- **フロントエンド**: `static/index.html` (Vue.js アプリケーション)

## 2. テスト環境
- **OS**: Windows 10/11, macOS
- **Python**: 3.11 以降
- **ブラウザ**: Google Chrome, Microsoft Edge, Firefox (それぞれ最新版)
- **その他**: OpenRouter APIキーが `.env` ファイルに正しく設定されていること。

## 3. テスト項目

### 3.1. バックエンド (`app.py`) テスト

#### 3.1.1. サーバー起動と基本動作
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 1  | サーバー起動 | `python app.py` を実行する。 | エラーなくサーバーが起動し、`http://localhost:5000/` で待ち受け状態になる。 |
| 2  | APIキー未設定での起動 | `.env` ファイルが存在しない、または `OPENROUTER_API_KEY` が空の状態で `python app.py` を実行する。 | "警告: 環境変数 OPENROUTER_API_KEY が設定されていません..." というメッセージがコンソールに表示され、サーバーは起動する。 |

#### 3.1.2. `/akinator_api` API
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 3  | **[正常系]** 初回リクエスト | `{"history": []}` をPOSTする。 | AIが最初の質問を生成し、`{"type": "question", "text": "..."}` の形式でJSONが返る。 |
| 4  | **[正常系]** 2回目以降のリクエスト | `{"history": [{"q": "...", "a": "..."}]}` のように、1件以上の履歴を含むJSONをPOSTする。 | 履歴に基づいた次の質問が `{"type": "question", "text": "..."}` の形式で返る。 |
| 5  | **[正常系]** 最終回答 | 質問を繰り返し、AIが回答を確信できる状態にする。 | `{"type": "answer", "text": "..."}` の形式でJSONが返る。 |
| 6  | **[異常系]** 不正なリクエスト | ボディが空、または `history` キーを含まないJSONをPOSTする。 | ステータスコード 400 Bad Request とエラーメッセージを含むJSONが返る。 |
| 7  | **[異常系]** APIキー未設定 | APIキー未設定の状態でAPIを呼び出す。 | ステータスコード 500 と `{"error": "OpenRouter API key is not configured..."}` を含むJSONが返る。 |

#### 3.1.3. `/undo_api` API
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 8  | **[正常系]** 戻る処理 | 1件以上の履歴を含む `{"history": [...]}` をPOSTする。 | 履歴の最後の項目を除いた状態で再生成された質問が `{"type": "question", "text": "..."}` の形式で返る。 |
| 9  | **[異常系]** 履歴なしで戻る | `{"history": []}` をPOSTする。 | ステータスコード 400 と `{"error": "履歴がないため、元に戻せません。"}` を含むJSONが返る。 |

### 3.2. フロントエンド (`static/index.html`) テスト

#### 3.2.1. ゲーム開始フロー
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 10 | スタート画面表示 | `http://localhost:5000/` にアクセスする。 | 「魔人の質問」というタイトルのスタート画面が表示される。 |
| 11 | ゲーム開始 | 「ゲームを開始する」ボタンをクリックする。 | スタート画面が非表示になり、ゲーム画面（質問表示エリアと回答ボタン）が表示される。最初の質問が読み込まれ、表示される。 |

#### 3.2.2. ゲームプレイ
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 12 | 質問への回答 | 「はい」「いいえ」などの回答ボタンをクリックする。 | ローディングスピナーが表示された後、次の質問が表示される。回答履歴が画面下部に追加される。 |
| 13 | 最終回答の表示 | ゲームを進め、AIが最終回答を提示する。 | 質問エリアが「あなたの思い浮かべているのは...」という最終回答表示に切り替わる。「正解！」「不正解...」ボタンが表示される。 |
| 14 | 一つ前に戻る | 回答後、「一つ前の質問に戻る」ボタンをクリックする。 | ローディングスピナーが表示された後、一つ前の質問が再表示される。回答履歴の最後の項目が削除される。 |
| 15 | 戻るボタンの表示制御 | 1. 最初の質問が表示されている状態。<br>2. 回答ボタンを押し、通信中の状態。 | 1, 2 の両方の状態で「一つ前の質問に戻る」ボタンが非表示になっている。 |

#### 3.2.3. ゲーム終了・継続フロー
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 16 | 正解の場合 | 最終回答画面で「正解！」ボタンをクリックする。 | 「もう一度遊ぶ」ボタンが表示される。 |
| 17 | 不正解の場合 | 最終回答画面で「不正解...」ボタンをクリックする。 | 「質問を続ける」「最初から」ボタンが表示される。 |
| 18 | ゲーム継続 | 不正解後、「質問を続ける」ボタンをクリックする。 | AIの最終回答が間違いであったことが履歴に追加され、新しい質問の読み込みが開始される。 |
| 19 | 最初から（不正解後） | 不正解後、「最初から」ボタンをクリックする。 | スタート画面に戻る。 |
| 20 | もう一度遊ぶ | 正解後、「もう一度遊ぶ」ボタンをクリックする。 | スタート画面に戻る。 |

#### 3.2.4. エラー表示
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 21 | API通信エラー | サーバーを停止するなどして、APIリクエストが失敗するようにする。 | ゲーム画面に「通信エラー: ...」という内容のエラーメッセージが表示される。 |
| 22 | サーバーエラー | APIが500エラーなどを返すようにする。 | ゲーム画面に「エラー: ...」という内容のエラーメッセージが表示される。 |

---

*このテスト仕様書は、アプリケーションの変更に伴い、適宜更新されるものとします。*
