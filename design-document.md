# Webアプリ仕様書

## 1. 概要

ユーザーが思い浮かべている人物、キャラクター、物などを、AIが質問を繰り返すことで当てるゲームアプリです。
AIからの質問に対し、ユーザーは「はい」「いいえ」「わからない」「たぶんそう」「部分的に違う」つの選択肢で回答します。AIは回答履歴を元に推測を絞り込み、最終的な答えを導き出します。

## 2. 主な機能

### 2.1 ゲーム進行機能
- ゲーム開始時に、ユーザーは頭の中に特定の対象を思い浮かべます。
- AIが最初の質問を画面に表示します。
- ユーザーは以下の5つのボタンのいずれかをクリックして回答します。
  - はい
  - いいえ
  - わからない
  - たぶんそう
  - 部分的に違う
- ユーザーの回答に応じて、AIは次の質問を生成し、画面に表示します。
- AIが答えを確信した時点で、推測した回答を提示します。
- 間違えた回答をしてしまった場合、ひとつ前の質問に戻ることができます・

### 2.2 生成AIリクエスト API
- フロントエンドから送られてきた過去の質問と回答の履歴を受け取ります。
- 履歴と定型のプロンプトを元に、次にすべき質問、または最終的な回答を生成AIにリクエストします。
- プロンプトには、AIが「質問を生成するモード」と「最終的な回答を推測するモード」を切り替えられるような指示を含みます。
- OpenRouter経由でLLM（例：GPT-4, Claude, Geminiなど）へリクエストを送信します。
- 応答をJSON形式でフロントエンドに返す。


## 3. 使用技術

| 分類         | 技術・ライブラリ |
|--------------|------------------|
| フロントエンド | Vue.js / HTML5 + CSS3 / JavaScript |
| バックエンド  | Flask |
| 通信方式     | Fetch API / JSON |
| LLMモデル    | OpenRouter API（OpenAI, Anthropic, Mistral等） |

## 4. 入出力例

### 入力
- ユーザーが「かぐや姫」を想定している場合の対話履歴

```json
{
  "history": [
    {"q": "そのキャラクターは女性ですか？", "a": "はい"},
    {"q": "そのキャラクターは物語の登場人物ですか？", "a": "はい"},
    {"q": "そのキャラクターは日本の物語に登場しますか？", "a": "はい"}
  ]
}
```

### 出力

- 出力例（次の質問）:
```json
{
  "type": "question",
  "text": "そのキャラクターは竹の中から生まれましたか？"
}
```

- 出力例（最終回答）:
```json
{
  "type": "answer",
  "text": "あなたの思い浮かべているキャラクターは「かぐや姫」ですね！"
}
```